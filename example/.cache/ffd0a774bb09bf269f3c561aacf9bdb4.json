{"dependencies":[{"name":"babel-runtime/helpers/classCallCheck"},{"name":"babel-runtime/helpers/createClass"},{"name":"./tool.js"},{"name":"./item.js"},{"name":"./queue.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _tool = require(\"./tool.js\");\n\nvar _item = require(\"./item.js\");\n\nvar _queue = require(\"./queue.js\");\n\nvar _queue2 = _interopRequireDefault(_queue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar testJson = {\n  background: {\n    type: 'color',\n    width: 400,\n    height: 400,\n    value: '#00ff00'\n  },\n  // background: {\n  //     type: 'image',\n  //     width: 400,\n  //     height: 400,\n  //     value: 'http://img2.3lian.com/2014/f5/63/d/16.jpg'\n  // },\n  items: [\n  // {\n  //     type: 'image',\n  //     top: 200,\n  //     left: 200,\n  //     width: 100,\n  //     height: 100,\n  //     rotate: 45,\n  //     opacity: 0.3,\n  //     value: 'http://img2.3lian.com/2014/f5/63/d/16.jpg'\n  // },\n  // {\n  //     type: 'image',\n  //     top: 200,\n  //     left: 90,\n  //     width: 100,\n  //     height: 100,\n  //     rotate: 30,\n  //     opacity: 0.7,\n  //     value: 'http://img2.3lian.com/2014/f5/63/d/16.jpg'\n  // },\n  {\n    type: 'text',\n    top: 200,\n    left: 90,\n    width: 100,\n    height: 100,\n    rotate: 0,\n    value: '我不好',\n    style: {\n      'font-size': 14,\n      'font-family': '',\n      'letter-spacing': 3,\n      'line-height': 28,\n      'text-align': 'center',\n      color: 'red'\n    }\n  }, {\n    type: 'text',\n    top: 0,\n    left: 0,\n    width: 100,\n    height: 100,\n    rotate: 0,\n    value: '你好哇，李银河',\n    style: {\n      'font-size': 14,\n      'font-family': '',\n      'letter-spacing': 3,\n      'line-height': 28,\n      'text-align': 'center',\n      color: 'red'\n    }\n  }, {\n    type: 'group',\n    top: 200,\n    left: 0,\n    width: 200,\n    height: 200,\n    rotate: 0,\n    items: [{\n      type: 'text',\n      top: 0,\n      left: 10,\n      width: 100,\n      height: 100,\n      rotate: 40,\n      value: '我不好',\n      style: {\n        'font-size': 14,\n        'font-family': '',\n        'letter-spacing': 3,\n        'line-height': 28,\n        'text-align': 'center',\n        color: 'red'\n      }\n    }, {\n      type: 'text',\n      top: 40,\n      left: 10,\n      width: 100,\n      height: 100,\n      rotate: 0,\n      value: '我不好',\n      style: {\n        'font-size': 14,\n        'font-family': '',\n        'letter-spacing': 3,\n        'line-height': 28,\n        'text-align': 'center',\n        color: 'red'\n      }\n    }]\n  }]\n\n  //为了保证图片绘制的顺序，\n};\nvar Frigg = function () {\n  function Frigg(data) {\n    (0, _classCallCheck3.default)(this, Frigg);\n\n    this.bgJson = data.background;\n    var ctx = this.createCanvas(this.bgJson.width, this.bgJson.height);\n    this.itemsJson = data.items;\n    this.createImage(ctx);\n  }\n\n  (0, _createClass3.default)(Frigg, [{\n    key: \"draw\",\n    value: function draw(ctx) {\n      this.drawBackground(ctx, this.bgJson);\n      this.drawItems(ctx, this.itemsJson);\n    }\n  }, {\n    key: \"createImage\",\n    value: function createImage(ctx) {\n      var _this = this;\n\n      this.draw(ctx);\n      _queue2.default.push(function () {\n        var image = _this.canvas.toDataURL();\n        (0, _tool.downloadFile)(image, 'template.jpg');\n      });\n      _queue2.default.next();\n    }\n  }, {\n    key: \"createCanvas\",\n    value: function createCanvas(width, height) {\n      var canvas = document.createElement('canvas');\n      canvas.crossorigin = 'anonymous';\n      document.body.append(canvas);\n      canvas.width = width;\n      canvas.height = height;\n      this.canvas = canvas;\n      var ctx = canvas.getContext('2d');\n      return ctx;\n    }\n  }, {\n    key: \"drawBackground\",\n    value: function drawBackground(ctx, bgJson) {\n      if (bgJson.type === 'color') {\n        ctx.fillStyle = bgJson.value;\n        ctx.fillRect(0, 0, bgJson.width, bgJson.height);\n      } else {\n        var bg = new _item.ImageItem(ctx, bgJson);\n        bg.add();\n      }\n    }\n  }, {\n    key: \"drawItems\",\n    value: function drawItems(ctx, itemsData) {\n      var _this2 = this;\n\n      if (itemsData.length <= 0 && !(0, _tool.isArray)(items)) return;\n      var TYPES = [_item.ImageItem, _item.TextItem, _item.TextGroupItem];\n      itemsData.forEach(function (element) {\n        TYPES.some(function (i) {\n          if (_this2.isItem(i, element.type)) {\n            var tmpItem = new i(ctx, element);\n            tmpItem.add();\n            return true;\n          }\n        });\n      });\n    }\n  }, {\n    key: \"isItem\",\n    value: function isItem(i, type) {\n      return i.name.toLowerCase().includes(type);\n    }\n  }]);\n  return Frigg;\n}();\n\n// new Frigg(testJson)\n\nexports.default = Frigg;"},"hash":"44ee39ea73c2770f1ac878b8defb6e2b"}